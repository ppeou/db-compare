const {columnsMapper, rowsMapper} = require('../util-auto-mapper');

((_m) => {
  const sampleData = {
    metaData:
      [{name: 'OWNER'},
        {name: 'TABLE_NAME'},
        {name: 'COLUMN_NAME'},
        {name: 'DATA_TYPE'},
        {name: 'DATA_LENGTH'},
        {name: 'DATA_PRECISION'},
        {name: 'DATA_SCALE'},
        {name: 'NULLABLE'},
        {name: 'COLUMN_ID'},
        {name: 'DATA_DEFAULT'}],
    rows:
      [['EQU_DEV',
        'COUNTRY',
        'GLOBE_ID',
        'NUMBER',
        22,
        null,
        null,
        'Y',
        3,
        null],
        ['EQU_DEV', 'COUNTRY', 'ID', 'NUMBER', 22, null, null, 'N', 1, null],
        ['EQU_DEV',
          'COUNTRY',
          'NAME',
          'VARCHAR2',
          20,
          null,
          null,
          'Y',
          2,
          null],
        ['EQU_DEV',
          'COUNTRY_STATE',
          'COUNTRY_NAME',
          'VARCHAR2',
          20,
          null,
          null,
          'Y',
          4,
          null],
        ['EQU_DEV',
          'COUNTRY_STATE',
          'COUTRY_ID',
          'NUMBER',
          22,
          null,
          null,
          'N',
          3,
          null],
        ['EQU_DEV',
          'COUNTRY_STATE',
          'STATE_ID',
          'NUMBER',
          22,
          null,
          null,
          'N',
          1,
          null],
        ['EQU_DEV',
          'COUNTRY_STATE',
          'STATE_NAME',
          'VARCHAR2',
          40,
          null,
          null,
          'Y',
          2,
          null],
        ['EQU_DEV',
          'GLOBE',
          'CREATED_BY',
          'VARCHAR2',
          10,
          null,
          null,
          'N',
          5,
          null],
        ['EQU_DEV',
          'GLOBE',
          'CREATED_ON',
          'DATE',
          7,
          null,
          null,
          'Y',
          4,
          '(SYSDATE)'],
        ['EQU_DEV',
          'GLOBE',
          'DESCRIPTION',
          'VARCHAR2',
          100,
          null,
          null,
          'Y',
          3,
          null],
        ['EQU_DEV', 'GLOBE', 'ID', 'NUMBER', 22, null, null, 'N', 1, null],
        ['EQU_DEV', 'GLOBE', 'NAME', 'VARCHAR2', 15, null, null, 'N', 2, null],
        ['EQU_DEV',
          'GLOBE',
          'UPDATED_BY',
          'VARCHAR2',
          10,
          null,
          null,
          'Y',
          7,
          'NULL '],
        ['EQU_DEV',
          'GLOBE',
          'UPDATED_ON',
          'DATE',
          7,
          null,
          null,
          'Y',
          6,
          '(SYSDATE)'],
        ['EQU_DEV',
          'GLOBE_COUNTRY',
          'COUNTRY_NAME',
          'VARCHAR2',
          20,
          null,
          null,
          'Y',
          4,
          null],
        ['EQU_DEV',
          'GLOBE_COUNTRY',
          'COUTRY_ID',
          'NUMBER',
          22,
          null,
          null,
          'N',
          3,
          null],
        ['EQU_DEV',
          'GLOBE_COUNTRY',
          'GLOBE_ID',
          'NUMBER',
          22,
          null,
          null,
          'N',
          1,
          null],
        ['EQU_DEV',
          'GLOBE_COUNTRY',
          'GLOBE_NAME',
          'VARCHAR2',
          15,
          null,
          null,
          'N',
          2,
          null],
        ['EQU_DEV',
          'SAMPLE_TABLE_TEMPLATE',
          'COLUMN_1',
          'NUMBER',
          22,
          null,
          0,
          'N',
          1,
          '5 '],
        ['EQU_DEV',
          'SAMPLE_TABLE_TEMPLATE',
          'COLUMN_2',
          'VARCHAR2',
          10,
          null,
          null,
          'Y',
          2,
          null],
        ['EQU_DEV',
          'SAMPLE_TABLE_TEMPLATE',
          'COLUMN_3',
          'NUMBER',
          22,
          5,
          2,
          'Y',
          3,
          '4\n'],
        ['EQU_DEV', 'STATE', 'ABBR', 'VARCHAR2', 2, null, null, 'Y', 3, null],
        ['EQU_DEV',
          'STATE',
          'CAPITAL',
          'VARCHAR2',
          50,
          null,
          null,
          'Y',
          4,
          'NULL'],
        ['EQU_DEV',
          'STATE',
          'COUNTRY_ID',
          'NUMBER',
          22,
          null,
          null,
          'Y',
          5,
          null],
        ['EQU_DEV', 'STATE', 'ID', 'NUMBER', 22, null, null, 'N', 1, null],
        ['EQU_DEV', 'STATE', 'NAME', 'VARCHAR2', 40, null, null, 'Y', 2, null],
        ['EQU_DEV',
          'STATE',
          'STATUS',
          'VARCHAR2',
          1,
          null,
          null,
          'Y',
          6,
          '\'-\' ']]
  };

  const fn = (data) => {
    const {metaData, rows} = data;

    const {
      OWNER, TABLE_NAME, COLUMN_NAME,
      DATA_TYPE, DATA_LENGTH, DATA_PRECISION, DATA_SCALE, DATA_DEFAULT, NULLABLE, COLUMN_ID
    } = columnsMapper(metaData);

    let tr;
    return rows.reduce((p, r) => {
      if (!p[r[OWNER]]) {p[r[OWNER]] = {};}
      if (!p[r[OWNER]][r[TABLE_NAME]]) {p[r[OWNER]][r[TABLE_NAME]] = {};}
      if (!p[r[OWNER]][r[TABLE_NAME]][r[COLUMN_NAME]]) {p[r[OWNER]][r[TABLE_NAME]][r[COLUMN_NAME]] = {};}

      p[r[OWNER]][r[TABLE_NAME]][r[COLUMN_NAME]] = [DATA_TYPE, DATA_LENGTH, DATA_PRECISION,
        DATA_SCALE, DATA_DEFAULT, NULLABLE].map(i => r[i]);

      return p;
    }, {});
  };

  //console.log(fn(sampleData));

  _m.exports = {allTableColumns: fn};
})(module);
